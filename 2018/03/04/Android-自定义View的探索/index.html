<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=7.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0"><link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.0.0",sidebar:{position:"left",display:"post",offset:12,b2t:!0,scrollpercent:!0,onmobile:!0},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="注意参考内容http://www.gcssloop.com/http://hencoder.com/《Android开发艺术探索》  
invalidate(); //重新绘制
绘图Paint 画笔paint.setAntiAlias(true);//抗锯齿paint.setColor(Color.RED);//颜色paint.setStyle(Paint.Style.STROKE); // S"><meta property="og:type" content="article"><meta property="og:title" content="Android 自定义View的探索"><meta property="og:url" content="http://cczhr.ink/2018/03/04/Android-自定义View的探索/index.html"><meta property="og:site_name" content="Not Found Blog"><meta property="og:description" content="注意参考内容http://www.gcssloop.com/http://hencoder.com/《Android开发艺术探索》  
invalidate(); //重新绘制
绘图Paint 画笔paint.setAntiAlias(true);//抗锯齿paint.setColor(Color.RED);//颜色paint.setStyle(Paint.Style.STROKE); // S"><meta property="og:image" content="http://ww2.sinaimg.cn/large/87c01ec7gy1foxd4rsjr6j20ji0cxjv7.jpg"><meta property="og:image" content="http://ww2.sinaimg.cn/large/87c01ec7gy1foxd5kezsrj20jl0qh7ak.jpg"><meta property="og:image" content="https://ws1.sinaimg.cn/large/006tKfTcgy1fj7x3rm1xxj30u50laq6y.jpg"><meta property="og:image" content="http://ww3.sinaimg.cn/large/87c01ec7gy1fox62kfvf0j20hr0i0dk3.jpg"><meta property="og:updated_time" content="2018-03-12T03:26:19.783Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Android 自定义View的探索"><meta name="twitter:description" content="注意参考内容http://www.gcssloop.com/http://hencoder.com/《Android开发艺术探索》  
invalidate(); //重新绘制
绘图Paint 画笔paint.setAntiAlias(true);//抗锯齿paint.setColor(Color.RED);//颜色paint.setStyle(Paint.Style.STROKE); // S"><meta name="twitter:image" content="http://ww2.sinaimg.cn/large/87c01ec7gy1foxd4rsjr6j20ji0cxjv7.jpg"><link rel="alternate" href="/atom.xml" title="Not Found Blog" type="application/atom+xml"><link rel="canonical" href="http://cczhr.ink/2018/03/04/Android-自定义View的探索/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>Android 自定义View的探索 | Not Found Blog</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Not Found Blog</span><span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://cczhr.ink/2018/03/04/Android-自定义View的探索/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="cczhr"><meta itemprop="description" content="或许你真的可以改变世界。"><meta itemprop="image" content="https://tva2.sinaimg.cn/crop.0.103.494.494.180/95a356e5jw8erb6uslwmrj20dq0jgjry.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Not Found Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Android 自定义View的探索</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-03-04 21:44:40" itemprop="dateCreated datePublished" datetime="2018-03-04T21:44:40+08:00">2018-03-04</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2018-03-12 11:26:19" itemprop="dateModified" datetime="2018-03-12T11:26:19+08:00">2018-03-12</time></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span> <a href="/2018/03/04/Android-自定义View的探索/#comments" itemprop="discussionUrl"><span class="post-meta-item-text">评论数：</span><span class="post-comments-count valine-comment-count" data-xid="/2018/03/04/Android-自定义View的探索/" itemprop="commentCount"></span></a></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">26k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">23 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><script src="\assets\js\APlayer.min.js"></script><h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>参考内容<br><a href="http://www.gcssloop.com/" target="_blank" rel="external">http://www.gcssloop.com/</a><br><a href="http://hencoder.com/" target="_blank" rel="external">http://hencoder.com/</a><br>《Android开发艺术探索》</p><pre><code>invalidate(); //重新绘制
</code></pre><h1 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h1><h2 id="Paint-画笔"><a href="#Paint-画笔" class="headerlink" title="Paint 画笔"></a>Paint 画笔</h2><p>paint.setAntiAlias(true);//抗锯齿<br>paint.setColor(Color.RED);//颜色<br>paint.setStyle(Paint.Style.STROKE); // Style 修改为画线模式 FILL 是填充模式，STROKE 是画线模式（即勾边模式），FILL_AND_STROKE 是两种模式一并使用：既画线又填充。它的默认值是 FILL，填充模式。<br>paint.setStrokeWidth(20); //STROKE 和 FILL_AND_STROKE 下，还可以使用 paint.setStrokeWidth(float width) 来设置线条的宽度：<br>paint.setTextSize(84);//设置字体大小<br>paint.setTypeface();//设置字体样式<br>paint.setStrokeCap(cap) //设置线冒样式 Cap.BUTT(无线帽)、Cap.SQUARE(方形线帽)、Cap.ROUND(圆形线冒)<br>setShader(Shader shader)</p><p>Shader 注意：在设置了 Shader 的情况下， Paint.setColor/ARGB() 所设置的颜色就不再起作用。<br>LinearGradient 线性渐变<br>Shader shader = new LinearGradient(float x0, float y0, float x1, float y1, int colors[], float positions[], TileMode tile)<br>第一个参数为线性起点的x坐标<br>第二个参数为线性起点的y坐标<br>第三个参数为线性终点的x坐标<br>第四个参数为线性终点的y坐标<br>第五个参数为实现渐变效果的颜色的组合<br>第六个参数为前面的颜色组合中的各颜色在渐变中占据的位置（比重），如果为空，则表示上述颜色的集合在渐变中均匀出现<br>第七个参数为渲染器平铺的模式，一共有三种<br>-CLAMP<br>边缘拉伸<br>-REPEAT<br>在水平和垂直两个方向上重复，相邻图像没有间隙<br>-MIRROR<br>以镜像的方式在水平和垂直两个方向上重复，相邻图像有间隙<br>LinearGradient(float x0, float y0, float x1, float y1, int color0, int color1, TileMode tile)<br>int color0表示渐变起始颜色<br>int color1表示渐变终止颜色</p><h2 id="Canvas-画布"><a href="#Canvas-画布" class="headerlink" title="Canvas 画布"></a>Canvas 画布</h2><p>改变坐标<br>//移动坐标原点<br>canvas.translate(x, y);//移动坐标原点，位移是基于当前位置移动<br>//缩放和翻转 可叠加<br>canvas.scale(float sx, float sy）<br>canvas.scale(float sx, float sy, float px, float py);//(缩放x轴比例,缩放y轴比例,缩放中心点x,缩放中心点y) 缩放x轴比例,缩放y轴比例为负数会图形根据中心点翻转， 缩放中心点x,y,缩放中心点代表图形向哪个点缩或者放。缩放是可以叠加的<br>//旋转 可叠加<br>rotate(float degrees);//旋转角度<br>rotate (float degrees, float px, float py)//旋转角度degrees 旋转中心点px,py</p><p>保存快照和回退<br><a href="http://www.gcssloop.com/customview/Canvas_Convert" target="_blank" rel="external">http://www.gcssloop.com/customview/Canvas_Convert</a><br>save();<br>save (int saveFlags);<br>回退<br>restore();<br>restoreToCount();//如果调用restoreToCount（2) 则会弹出 2 3 4 5 的状态，并根据第2次保存的状态进行恢复。</p><p>//错切 可叠加<br>skew (float sx, float sy）<br>float sx:将画布在x方向上倾斜相应的角度，sx倾斜角度的tan值，<br>float sy:将画布在y轴方向上倾斜相应的角度，sy为倾斜角度的tan值.</p><p>//绘制画布颜色<br> canvas.drawColor(Color.parseColor(“#88880000”));（半透明颜色会加遮罩）另外有 drawRGB(int r, int g, int b) 和 drawARGB(int a, int r, int g, int b)<br> 这类颜色填充方法一般用于在绘制之前设置底色，或者在绘制之后为界面设置半透明蒙版。</p><p>//画点<br>drawPoint(float x, float y, Paint paint)//(点x坐标,点y坐标, Paint paint) //点的大小可以通过 paint.setStrokeWidth(width) 来设置；点的形状可以通过 paint.setStrokeCap(cap) 来设置：ROUND 画出来是圆形的点，SQUARE 或 BUTT 画出来是方形的点。<br>// 和FILL 模式下的 drawCircle() 和 drawRect()一样</p><p>//批量画点</p><p>float[] points = {0, 0, 50, 50, 50, 100, 100, 50, 100, 100, 150, 50, 150, 100};<br>drawPoints(float[] pts, int offset, int count, Paint paint) / drawPoints(float[] pts, Paint paint) //offset偏移量 点数量<br>//canvas.drawPoints(points, 2 / <em>跳过两个数，即前两个 0</em> /, 8 / <em>一共绘制 8 个数（4 个点）</em>/, paint);</p><p>//画线<br>drawLine(200, 200, 800, 500, paint); //drawLine(左边x轴起点, 上边y轴起点 右边x轴终点, 下边y轴终点, Paint paint)</p><p>//批量划线<br>float[] points = {20, 20, 120, 20, 70, 20, 70, 120, 20, 120, 120, 120, 150, 20, 250, 20, 150, 20, 150, 120, 250, 20, 250, 120, 150, 120, 250, 120};<br>drawLines(points, paint);</p><p>//画矩形 支持RectF<br>drawRect(float left, float top, float right, float bottom, Paint paint) ; ( 左边x轴起点, 上边y轴起点 右边x轴终点, 下边y轴终点, Paint paint)</p><p>//圆角矩形 支持RectF<br>drawRoundRect(左边x轴起点, 上边y轴起点 右边x轴终点, 下边y轴终点， float rx, float ry, Paint paint) //rx 和 ry 是圆角的横向半径和纵向半径。</p><p>//画圆<br>drawCircle(float centerX, float centerY, float radius, Paint paint) 画圆 （圆心x坐标,圆心y坐标,半径,画笔）</p><p>//画椭圆<br>drawOval(float left, float top, float right, float bottom, Paint paint) //( 左边x轴起点, 上边y轴起点 右边x轴终点, 下边y轴终点, Paint paint)<br>//绘制弧形或扇形<br>drawArc(float left, float top, float right, float bottom, float startAngle, float sweepAngle, boolean useCenter, Paint paint)<br>//drawArc() 是使用一个椭圆来描述弧形的 startAngle 是弧形的起始角度（x 轴的正向，即正右的方向，是 0 度的位置；顺时针为正角度，逆时针为负角度），sweepAngle 是弧形划过的角度；<br>//useCenter 表示是否连接到圆心，如果不连接到圆心，就是弧形，如果连接到圆心，就是扇形。</p><p>画 Bitmap<br>drawBitmap(Bitmap bitmap, float left, float top, Paint paint) 画 Bitmap<br>drawBitmap(Bitmap bitmap, Rect src, RectF dst, Paint paint) /<br> drawBitmap(Bitmap bitmap, Rect src, Rect dst, Paint paint) / //Rect src 指定绘制图片的区域, Rect dst 指定图片在屏幕上显示的区域<br> drawBitmap(Bitmap bitmap, Matrix matrix, Paint paint)<br>绘制文字<br>drawText(String text, float x, float y, Paint paint) 绘制文字<br>drawText(str,1,3,200,500,textPaint);// (字符串 开始截取位置 结束截取位置 基线x 基线y 画笔)<br>指定字符位置<br>drawPosText(str,new float[]{<br> 100,100, // 第一个字符位置<br> 200,200, // 第二个字符位置<br> 300,300, // …<br> 400,400,<br> 500,500<br>},textPaint);<br>drawPosText (char[] text, int index, int count, float[] pos, Paint paint)</p><p>//画自定义图形 通过描述路径的方式来绘制图形<br>canvas.drawPath(path, paint);</p><h3 id="描述路径Path"><a href="#描述路径Path" class="headerlink" title="描述路径Path"></a>描述路径Path</h3><p> Path path = new Path();</p><h4 id="图形交叉的填充方式"><a href="#图形交叉的填充方式" class="headerlink" title="图形交叉的填充方式"></a>图形交叉的填充方式</h4><p>//setFillType(Path.FillType ft) 设置填充方式<br>//Path.FillType.WINDING 默认值(全填充)<br>//Path.FillType.EVEN_ODD 交叉填充<br>//带有 INVERSE 前缀是反色</p><p><img src="http://ww2.sinaimg.cn/large/87c01ec7gy1foxd4rsjr6j20ji0cxjv7.jpg" alt=""><br><img src="http://ww2.sinaimg.cn/large/87c01ec7gy1foxd5kezsrj20jl0qh7ak.jpg" alt=""></p><h4 id="路径方向-Direction-dir"><a href="#路径方向-Direction-dir" class="headerlink" title="路径方向(Direction dir)"></a>路径方向(Direction dir)</h4><p> Path.Direction.CW //顺时针<br> Path.Direction.CCW //逆时针</p><h4 id="添加图形"><a href="#添加图形" class="headerlink" title="添加图形"></a>添加图形</h4><p>addCircle(float centerX, float centerY, float radius, Direction dir) 添加圆形<br>addOval(float left, float top, float right, float bottom, Direction dir) / addOval(RectF oval, Direction dir) 添加椭圆<br>addRect(float left, float top, float right, float bottom, Direction dir) / addRect(RectF rect, Direction dir) 添加矩形<br>addRoundRect(RectF rect, float rx, float ry, Direction dir) / addRoundRect(float left, float top, float right, float bottom, float rx, float ry, Direction dir)<br>/ addRoundRect(RectF rect, float[] radii, Direction dir) / addRoundRect(float left, float top, float right, float bottom, float[] radii, Direction dir) 添加圆角矩形</p><h4 id="添加线条"><a href="#添加线条" class="headerlink" title="添加线条"></a>添加线条</h4><p>lineTo(float x, float y) （绝对坐标 开始坐标为 0，0） / rLineTo(float x, float y) （相对坐标，指最后 调用画 Path 的方法的终点位置）</p><p>quadTo(float x1, float y1, float x2, float y2)<br>/ rQuadTo(float dx1, float dy1, float dx2, float dy2) 画二次贝塞尔曲线<br>这条二次贝塞尔曲线的起点就是当前位置，而参数中的 x1, y1 和 x2, y2 则分别是控制点和终点的坐标。和 rLineTo(x, y) 同理，rQuadTo(dx1, dy1, dx2, dy2) 的参数也是相对坐标</p><p>cubicTo(float x1, float y1, float x2, float y2, float x3, float y3)<br>/ rCubicTo(float x1, float y1, float x2, float y2, float x3, float y3) 画三次贝塞尔曲线</p><h4 id="移动坐标"><a href="#移动坐标" class="headerlink" title="移动坐标"></a>移动坐标</h4><p>moveTo(float x, float y) / rMoveTo(float x, float y) 移动到目标位置</p><p>setLastPoint(x,y); //重置上一次操作的最后一个点</p><h4 id="画弧形"><a href="#画弧形" class="headerlink" title="画弧形"></a>画弧形</h4><p>arcTo(RectF oval, float startAngle, float sweepAngle, boolean forceMoveTo) /<br>arcTo(float left, float top, float right, float bottom, float startAngle, float sweepAngle, boolean forceMoveTo) /<br>arcTo(RectF oval, float startAngle, float sweepAngle) 画弧形 forceMoveTo为true表示不拖笔 false为拖笔</p><p>//默认不拖笔<br>addArc(float left, float top, float right, float bottom, float startAngle, float sweepAngle) /<br> addArc(RectF oval, float startAngle, float sweepAngle)</p><h4 id="平移"><a href="#平移" class="headerlink" title="平移"></a>平移</h4><p> offset (float dx, float dy)<br> offset (float dx, float dy, Path dst) Path dst 把平移的Path保存给dst 会覆盖dst原有的 同时最开始调用 path.offset 不会修改path<br> //重置<br> path.reset();</p><h4 id="添加另一个path"><a href="#添加另一个path" class="headerlink" title="添加另一个path"></a>添加另一个path</h4><p>addPath(Path path)<br>封闭图形 （将起始点和结束点连接）<br>path.close();<br>不是所有的子图形都需要使用 close() 来封闭。当需要填充图形时（即 Paint.Style 为 FILL 或 FILL_AND_STROKE），Path 会自动封闭子图形。</p><h4 id="PathMeasure-测量path"><a href="#PathMeasure-测量path" class="headerlink" title="PathMeasure 测量path"></a>PathMeasure 测量path</h4><p>关联path<br> PathMeasure ()<br> 用这个构造函数可创建一个空的 PathMeasure，但是使用之前需要先调用 setPath 方法来与 Path 进行关联。被关联的 Path 必须是已经创建好的，如果关联之后 Path 内容进行了更改，则需要使用 setPath 方法重新关联。</p><p> PathMeasure (Path path, boolean forceClosed)<br> 用这个构造函数是创建一个 PathMeasure 并关联一个 Path， 其实和创建一个空的 PathMeasure 后调用 setPath 进行关联效果是一样的，同样，被关联的 Path 也必须是已经创建好的，如果关联之后 Path 内容进行了更改，则需要使用 setPath 方法重新关联。不论 forceClosed 设置为何种状态(true 或者 false)， 都不会影响原有Path显示的状态，设置闭合后如果是非闭合path则测量的长度为会加上闭合的长度。</p><p>该方法有两个参数，第一个参数自然就是被关联的 Path 了，第二个参数是用来确保 Path 闭合，如果设置为 true， 则不论之前Path是否闭合，都会自动闭合该 Path(如果Path可以闭合的话)。<br>setPath 是 PathMeasure 与 Path 关联的重要方法，效果和 构造函数 中两个参数的作用是一样的。<br>isClosed 用于判断 Path 是否闭合，但是如果你在关联 Path 的时候设置 forceClosed 为 true 的话，这个方法的返回值则一定为true。<br>测量<br>测量 默认是选取path最外层的曲线<br>float getLength(); 用于获取 Path 的总长度。<br>boolean getSegment (float startD, float stopD, Path dst, boolean startWithMoveTo) 截取Path的一个片段 返回true为截取成功 startD为开始长度 stopD为结束长度 要注意path的方向 startWithMoveTo 是否保留截取的起点的位置，false就会把截取的path的起点放到dst的终点 有可能导致截取的path形变。<br>boolean nextContour(); 跳转到path的下一条曲线 成功返回true</p><p>boolean getPosTan (float distance, float[] pos, float[] tan)得到路径上某一长度的位置以及该位置的正切值 成功返回true distance距离 Path 起点的长度 pos[0]为x坐标 pos[1]为y坐标 tan[0]是邻边边长，tan[1]是对边边长 邻边对边是由pos的坐标与坐标轴原点连接构成一个直角三角形得到的<br>Math.atan2(tan[1], tan[0]) 获取到正切角的弧度值<br>(float) (Math.atan2(tan[1], tan[0]) * 180.0 / Math.PI) 弧度转角度</p><p>录制Canvas<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1.创建Picture</span></div><div class="line"><span class="keyword">private</span> Picture mPicture = <span class="keyword">new</span> Picture();</div><div class="line"></div><div class="line">---------------------------------------------------------------</div><div class="line"></div><div class="line"><span class="comment">// 2.录制内容方法</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">recording</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// 开始录制 (接收返回值Canvas)</span></div><div class="line">    Canvas canvas = mPicture.beginRecording(<span class="number">500</span>, <span class="number">500</span>);</div><div class="line">    <span class="comment">// 创建一个画笔</span></div><div class="line">    Paint paint = <span class="keyword">new</span> Paint();</div><div class="line">    paint.setColor(Color.BLUE);</div><div class="line">    paint.setStyle(Paint.Style.FILL);</div><div class="line"></div><div class="line">    <span class="comment">// 在Canvas中具体操作</span></div><div class="line">    <span class="comment">// 位移</span></div><div class="line">    canvas.translate(<span class="number">250</span>,<span class="number">250</span>);</div><div class="line">    <span class="comment">// 绘制一个圆</span></div><div class="line">    canvas.drawCircle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">100</span>,paint);</div><div class="line"></div><div class="line">    mPicture.endRecording();</div><div class="line">&#125;</div><div class="line"></div><div class="line">---------------------------------------------------------------</div><div class="line"></div><div class="line"><span class="comment">// 3.在使用前调用(我在构造函数中调用了)</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Canvas3</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(context, attrs);</div><div class="line">    </div><div class="line">    recording();    <span class="comment">// 调用录制</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">回放</div><div class="line">canvas.drawPicture(mPicture,<span class="keyword">new</span> RectF(<span class="number">0</span>,<span class="number">0</span>,mPicture.getWidth(),<span class="number">200</span>));<span class="comment">//RectF Rect 小于录制大小会缩放</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 包装成为Drawable</span></div><div class="line">PictureDrawable drawable = <span class="keyword">new</span> PictureDrawable(mPicture);</div><div class="line"><span class="comment">// 设置绘制区域 -- 注意此处所绘制的实际内容不会缩放</span></div><div class="line">drawable.setBounds(<span class="number">0</span>,<span class="number">0</span>,<span class="number">250</span>,mPicture.getHeight());</div><div class="line"><span class="comment">// 绘制</span></div><div class="line">drawable.draw(canvas);</div><div class="line">setBounds是设置在画布上的绘制区域，并非根据该区域进行缩放，也不是剪裁Picture，每次都从Picture的左上角开始绘制。</div></pre></td></tr></table></figure><p></p><h2 id="绘制顺序"><a href="#绘制顺序" class="headerlink" title="绘制顺序"></a>绘制顺序</h2><p>第 1 步——背景，它的绘制发生在一个叫 drawBackground() 的方法里，但这个方法是 private 的，不能重写，你如果要设置背景，只能用自带的 API 去设置（xml 布局文件的 android:background 属性以及 Java 代码的 View.setBackgroundXxx() 方法，第2步主体onDraw() 第3步子view dispatchDraw()第4步onDrawForeground() 滑动边缘渐变和滑动条<br>onDraw()<br>不是继承view的情况下 view的onDraw()原本就是空实现<br>把绘制代码写在 super.onDraw() 的下面，由于绘制代码会在原有内容绘制结束之后才执行，所以绘制内容就会盖住控件原来的内容。如果把绘制代码写在 super.onDraw() 的上面，由于绘制代码会执行在原有内容的绘制之前，所以绘制的内容会被控件的原内容盖住。</p><p>有子view<br><a href="http://hencoder.com/ui-1-5/" target="_blank" rel="external">http://hencoder.com/ui-1-5/</a><br>dispatchDraw()<br>ViewGroup 会先调用自己的 onDraw() 来绘制完自己的主体之后再去调用dispatchDraw()绘制它的子 View 写在 super.dispatchDraw() 后能让绘制内容盖住子 View ， 写在super.dispatchDraw()前，也就是绘制内容会出现在主体内容和子 View 之间</p><p>onDrawForeground()(API 23安卓6.0才能用)<br> 写在 super.onDrawForeground() 的下面绘制代码会在滑动边缘渐变、滑动条和前景之后被执行，那么绘制内容将会盖住滑动边缘渐变、滑动条和前景。<br> 如果你把绘制代码写在了 super.onDrawForeground() 的上面，绘制内容就会在 dispatchDraw() 和 super.onDrawForeground() 之间执行，那么绘制内容会盖住子 View，但被滑动边缘渐变、滑动条以及前景盖住：</p><h1 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h1><h2 id="属性动画"><a href="#属性动画" class="headerlink" title="属性动画"></a>属性动画</h2><p> <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fj7x3rm1xxj30u50laq6y.jpg" alt=""><br> translationX() 和 translationXBy() 这两个方法的区别是：前者表示移动到某个坐标值，后者表示移动了多少距离。</p><h3 id="ViewPropertyAnimator"><a href="#ViewPropertyAnimator" class="headerlink" title="ViewPropertyAnimator"></a>ViewPropertyAnimator</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">view.animate().translationX(<span class="number">500</span>);</div></pre></td></tr></table></figure><p><a href="http://hencoder.com/ui-1-6/" target="_blank" rel="external">http://hencoder.com/ui-1-6/</a></p><h3 id="ObjectAnimator"><a href="#ObjectAnimator" class="headerlink" title="ObjectAnimator"></a>ObjectAnimator</h3><pre><code>如果是自定义控件，需要添加 setter / getter 方法；
</code></pre><p>例子<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SportsView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;  </div><div class="line">  <span class="keyword">float</span> progress = <span class="number">0</span>;</div><div class="line"></div><div class="line">    ......</div><div class="line"></div><div class="line">    <span class="comment">// 创建 getter 方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getProgress</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> progress;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 创建 setter 方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProgress</span><span class="params">(<span class="keyword">float</span> progress)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.progress = progress;</div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line"></div><div class="line">        ......</div><div class="line"></div><div class="line">        canvas.drawArc(arcRectF, <span class="number">135</span>, progress * <span class="number">2.7f</span>, <span class="keyword">false</span>, paint);</div><div class="line"></div><div class="line">        ......</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">......</div><div class="line"></div><div class="line"><span class="comment">// 创建 ObjectAnimator 对象</span></div><div class="line">ObjectAnimator animator = ObjectAnimator.ofFloat(view, <span class="string">"progress"</span>, <span class="number">0</span>, <span class="number">65</span>);  </div><div class="line"><span class="comment">// 执行动画</span></div><div class="line">animator.start();</div></pre></td></tr></table></figure><p></p><p>属性使用例子<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// tvT为控件名称 若为自定义view内部则用this</span></div><div class="line"><span class="comment">//颜色渐变</span></div><div class="line">        ObjectAnimator animator = ObjectAnimator.ofInt(tvT, <span class="string">"BackgroundColor"</span>, <span class="number">0xffff0000</span>, <span class="number">0xff00ff00</span>);</div><div class="line">        animator.setEvaluator(<span class="keyword">new</span> ArgbEvaluator());</div><div class="line">        animator.setDuration(<span class="number">3000</span>); <span class="comment">// 设置动画持续时间</span></div><div class="line"></div><div class="line">        <span class="comment">//平移</span></div><div class="line">        ObjectAnimator animator1 = ObjectAnimator.ofFloat(tvT, <span class="string">"translationX"</span>, <span class="number">0</span>,<span class="number">500</span>,<span class="number">0</span>,<span class="number">200</span>);</div><div class="line">        animator1.setInterpolator(<span class="keyword">new</span> OvershootInterpolator());<span class="comment">//时间插值器 回弹</span></div><div class="line">        animator1.setDuration(<span class="number">1000</span>);</div><div class="line"></div><div class="line">        <span class="comment">//同时改变多个属性</span></div><div class="line">        PropertyValuesHolder holder1 = PropertyValuesHolder.ofFloat(<span class="string">"scaleX"</span>, <span class="number">2</span>);<span class="comment">//改变尺寸</span></div><div class="line">        PropertyValuesHolder holder2 = PropertyValuesHolder.ofFloat(<span class="string">"scaleY"</span>, <span class="number">5</span>);</div><div class="line">        PropertyValuesHolder holder3 = PropertyValuesHolder.ofFloat(<span class="string">"alpha"</span>, <span class="number">0.5f</span>);<span class="comment">//改变透明度</span></div><div class="line">        PropertyValuesHolder holder4 = PropertyValuesHolder.ofFloat(<span class="string">"rotation"</span>, <span class="number">0</span>,<span class="number">90</span>,<span class="number">180</span>);<span class="comment">//z轴旋转</span></div><div class="line">        PropertyValuesHolder holder5 = PropertyValuesHolder.ofFloat(<span class="string">"rotationX"</span>, <span class="number">0</span>,<span class="number">90</span>,<span class="number">180</span>);<span class="comment">//x轴旋转</span></div><div class="line">        PropertyValuesHolder holder6 = PropertyValuesHolder.ofFloat(<span class="string">"rotationY"</span>, <span class="number">0</span>,<span class="number">90</span>,<span class="number">180</span>);<span class="comment">//y轴旋转</span></div><div class="line">        ObjectAnimator animator2 = ObjectAnimator.ofPropertyValuesHolder(tvT, holder1, holder2, holder3,holder4,holder5,holder6);</div><div class="line">        animator2.setDuration(<span class="number">1000</span>);</div><div class="line"></div><div class="line">        <span class="comment">//平移</span></div><div class="line">        ObjectAnimator animator3 = ObjectAnimator.ofFloat(tvT, <span class="string">"translationY"</span>, <span class="number">500</span>);</div><div class="line">        animator3.setDuration(<span class="number">2000</span>);</div><div class="line">        <span class="comment">//animator.pause();//暂停</span></div><div class="line"></div><div class="line">  </div><div class="line">		</div><div class="line">		 <span class="comment">//多个动画依次执行</span></div><div class="line">     <span class="comment">/*   animatorSet.playSequentially(animator, animator1,animator2);</span></div><div class="line">        animatorSet.start();*/</div><div class="line">		</div><div class="line">		<span class="comment">//多个动画一起执行</span></div><div class="line">		<span class="comment">/*animatorSet.playTogether(animator, animator1,animator2);</span></div><div class="line">		 animatorSet.start()*/</div><div class="line"></div><div class="line">       <span class="comment">// 属性动画合集</span></div><div class="line">        AnimatorSet animatorSet = <span class="keyword">new</span> AnimatorSet();</div><div class="line">		</div><div class="line">         <span class="comment">/*顺序为animator&gt;&gt;animator1&amp;&amp;animator2&gt;&gt;animator3*/</span></div><div class="line">        animatorSet.play(animator1).with(animator2);<span class="comment">//同时进行</span></div><div class="line">        animatorSet.play(animator1).before(animator3);<span class="comment">//animator1在animator3之前</span></div><div class="line">        animatorSet.play(animator1).after(animator);<span class="comment">//animator1在animator之后</span></div><div class="line">        animatorSet.start();</div></pre></td></tr></table></figure><p></p><p>插值器类型<br>AccelerateInterpolator()加速动画<br>DecelerateInterpolator()减速动画<br>AccelerateDecelerateInterpolator()先加速在减速<br>AnticipateInterpolator()先反向压缩一小段，然后在加速弹出<br>AnticipateOvershootInterpolator()先反向一段，然后加速反向回来，执行完毕自带回弹效果<br>BounceInterpolator()执行完毕之后会回弹跳跃几段<br>CycleInterpolator(2)循环，动画循环一定次数<br>LinearInterpolator()线性均匀改变<br>OvershootInterpolator加速执行，结束之后回弹</p><h1 id="事件分发机制"><a href="#事件分发机制" class="headerlink" title="事件分发机制"></a>事件分发机制</h1><h2 id="view的事件分发机制"><a href="#view的事件分发机制" class="headerlink" title="view的事件分发机制"></a>view的事件分发机制</h2><p> <a href="https://www.jianshu.com/p/0b821660b195" target="_blank" rel="external">https://www.jianshu.com/p/0b821660b195</a><br> <a href="http://www.gcssloop.com/customview/dispatch-touchevent-theory" target="_blank" rel="external">http://www.gcssloop.com/customview/dispatch-touchevent-theory</a><br> 图<br> Activity －&gt; PhoneWindow －&gt; DecorView －&gt; ViewGroup －&gt; … －&gt; View<br> Activity &lt;－ PhoneWindow &lt;－ DecorView &lt;－ ViewGroup &lt;－ … &lt;－ View<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//原理伪代码</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">    <span class="keyword">boolean</span> result = <span class="keyword">false</span>;             <span class="comment">// 默认状态为没有消费过</span></div><div class="line"></div><div class="line"><span class="comment">//ViewGroup才有这个步骤</span></div><div class="line">    <span class="keyword">if</span> (!onInterceptTouchEvent(ev)) &#123;   <span class="comment">// 如果没有拦截交给子View</span></div><div class="line">        result = child.dispatchTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!result) &#123;                      <span class="comment">// 如果事件没有被消费,询问自身onTouchEvent</span></div><div class="line">        result = onTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p><h3 id="dispatchTouchEvent-事件分发-Activity-ViewGroup-View"><a href="#dispatchTouchEvent-事件分发-Activity-ViewGroup-View" class="headerlink" title="dispatchTouchEvent 事件分发(Activity ViewGroup View)"></a>dispatchTouchEvent 事件分发(Activity ViewGroup View)</h3><p>只要事件能传到当前view一定调用 主要控制最终控制是否回传父view 不特指的话只要onTouchEvent()方法或者OnTouchListener()返回了true它就返回true<br>为false时回传子view dispatchTouchEvent</p><h3 id="onInterceptTouchEvent-事件拦截-ViewGroup-ViewGroup默认不拦截"><a href="#onInterceptTouchEvent-事件拦截-ViewGroup-ViewGroup默认不拦截" class="headerlink" title="onInterceptTouchEvent 事件拦截(ViewGroup)  ViewGroup默认不拦截"></a>onInterceptTouchEvent 事件拦截(ViewGroup) ViewGroup默认不拦截</h3><p>表示是否拦截此事件 true为拦截 拦截后执行 onTouchEvent false则传给他的子view dispatchTouchEvent</p><h3 id="onTouchEvent-事件消费-Activity-ViewGroup-View-主要处理点击事件"><a href="#onTouchEvent-事件消费-Activity-ViewGroup-View-主要处理点击事件" class="headerlink" title="onTouchEvent 事件消费(Activity ViewGroup View)  主要处理点击事件"></a>onTouchEvent 事件消费(Activity ViewGroup View) 主要处理点击事件</h3><p>如果返回false dispatchTouchEvent也返回false<br>在同一个View或者ViewGroup的事件处理中，OnTouchListener优先级最高，OnTouchEvent其次，OnClickListener最低。OnTouchListener返回true则OnTouchEvent以下皆不执行<br>OnTouchEvent 返回true 且 super.onTouchEvent(event)才执行OnClickListener方法.</p><h3 id="view的分发"><a href="#view的分发" class="headerlink" title="view的分发"></a>view的分发</h3><ol><li>不论 View 自身是否注册点击事件，只要 View 是可点击的就会消费事件。</li><li>事件是否被消费由返回值决定，true 表示消费，false 表示不消费，与是否使用了事件无关。<br>事件的调度顺序应该是 onTouchListener &gt; onTouchEvent &gt; onLongClickListener &gt; onClickListener。</li></ol><h3 id="VIewGroup的分发"><a href="#VIewGroup的分发" class="headerlink" title="VIewGroup的分发"></a>VIewGroup的分发</h3><p>1.判断自身是否需要(询问 onInterceptTouchEvent 是否拦截)，如果需要，调用自己的 onTouchEvent。<br>2.自身不需要或者不确定，则询问 ChildView ，一般来说是调用手指触摸位置的 ChildView。<br>3.如果子 ChildView 不需要则调用自身的 onTouchEvent。<br>4.ViewGroup 中可能有多个 ChildView，会把所有的 ChildView 遍历一遍，如果手指触摸的点在 ChildView 区域内就分发给这个View。<br>5.当 ChildView 重叠时，一般会分配给显示在最上面的 ChildView。<br>6.只有 View1 可点击时，事件将会分配给 View1，即使被 View2 遮挡，这一部分仍是 View1 的可点击区域。只有 View2 可点击时，事件将会分配给 View2。<br>View1 和 View2 均可点击时，事件会分配给后加载的 View2，View2 将事件消费掉，View1接收不到事件。<br>7.ViewGroup 和 ChildView 同时注册了事件监听器(onClick等)，事件优先给 ChildView，会被 ChildView消费掉，ViewGroup 不会响应。</p><h2 id="MotionEvent"><a href="#MotionEvent" class="headerlink" title="MotionEvent"></a>MotionEvent</h2><p>详细内容左转<br><a href="http://www.gcssloop.com/customview/motionevent" target="_blank" rel="external">http://www.gcssloop.com/customview/motionevent</a><br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">TextView tvT = (TextView) findViewById(R.id.tv_t);</div><div class="line">tvT.setClickable(<span class="keyword">true</span>);</div><div class="line">       tvT.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</div><div class="line">           <span class="meta">@Override</span></div><div class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View view, MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">              <span class="comment">// motionEvent.getAction() 单点触控</span></div><div class="line"></div><div class="line">               <span class="keyword">switch</span> (motionEvent.getActionMasked())&#123;<span class="comment">//多点触控</span></div><div class="line">                   <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">                       Log.e(<span class="string">"MotionEvent"</span>, <span class="string">"ACTION_DOWN "</span>);</div><div class="line">                       <span class="comment">// 手指按下</span></div><div class="line">                       <span class="keyword">break</span>;</div><div class="line">                   <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">                       Log.e(<span class="string">"MotionEvent"</span>, <span class="string">"ACTION_MOVE"</span>);</div><div class="line">                       <span class="comment">// 手指移动</span></div><div class="line">                       <span class="keyword">break</span>;</div><div class="line">                   <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">                       Log.e(<span class="string">"MotionEvent"</span>, <span class="string">"ACTION_UP"</span>);</div><div class="line">                       <span class="comment">// 手指抬起</span></div><div class="line">                       <span class="keyword">break</span>;</div><div class="line">                   <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</div><div class="line">                       Log.e(<span class="string">"MotionEvent"</span>, <span class="string">"ACTION_CANCEL"</span>);</div><div class="line">                       <span class="comment">// 事件被拦截</span></div><div class="line">                       <span class="keyword">break</span>;</div><div class="line">                   <span class="keyword">case</span> MotionEvent.ACTION_OUTSIDE:</div><div class="line">                       Log.e(<span class="string">"MotionEvent"</span>, <span class="string">"ACTION_OUTSIDE"</span>);</div><div class="line">                       <span class="comment">// 超出区域</span></div><div class="line">                       <span class="keyword">break</span>;</div><div class="line">                   <span class="keyword">case</span> MotionEvent.ACTION_POINTER_DOWN:<span class="comment">//getActionMasked()才有</span></div><div class="line">                       Log.e(<span class="string">"MotionEvent"</span>, <span class="string">"ACTION_POINTER_DOWN"</span>);</div><div class="line">                       <span class="comment">// 有非主要的手指按下(即按下之前已经有手指在屏幕上)。</span></div><div class="line">                       <span class="keyword">break</span>;</div><div class="line">                   <span class="keyword">case</span> MotionEvent.ACTION_POINTER_UP:<span class="comment">//getActionMasked()才有</span></div><div class="line">                       Log.e(<span class="string">"MotionEvent"</span>, <span class="string">"ACTION_POINTER_UP"</span>);</div><div class="line">                       <span class="comment">// 有非主要的手指按下(即按下之前已经有手指在屏幕上)。</span></div><div class="line">                       <span class="keyword">break</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;);</div></pre></td></tr></table></figure><p></p><h2 id="TouchSlop"><a href="#TouchSlop" class="headerlink" title="TouchSlop"></a>TouchSlop</h2><p>通过：ViewConfiguration.get(getContext()).getScaledTouchSlop() 获取系统的滑动常量来，判断此时是否属于滑动事件，TouchSlop在各家手机系统默认值是不同的。</p><h2 id="VelocityTracker"><a href="#VelocityTracker" class="headerlink" title="VelocityTracker"></a>VelocityTracker</h2><p>用于跟踪手指滑动的速度，包括x轴方向和y轴方向的速度。如快速滑动或者其他手势操作。<br>一般在MotionEvent.ACTION_DOWN初始化<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">VelocityTracker  velocityTracker = VelocityTracker.obtain();<span class="comment">//获取实例</span></div></pre></td></tr></table></figure><p></p><p>在 MotionEvent.ACTION_MOVE 追踪速度<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">velocityTracker.addMovement(event);<span class="comment">//当前的 移动事件传递给VelocityTracker对象</span></div><div class="line">velocityTracker.computeCurrentVelocity(<span class="number">1000</span>);<span class="comment">//多少毫秒滑动的像素数</span></div><div class="line">xVelocity = (<span class="keyword">int</span>) velocityTracker.getXVelocity();<span class="comment">//x像素</span></div><div class="line">yVelocity = (<span class="keyword">int</span>) velocityTracker.getYVelocity();<span class="comment">//y像素</span></div></pre></td></tr></table></figure><p></p><p>在 MotionEvent.ACTION_CANCEL 回收<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">velocityTracker.clear();</div><div class="line">velocityTracker.recycle();</div></pre></td></tr></table></figure><p></p><h2 id="GestureDetector"><a href="#GestureDetector" class="headerlink" title="GestureDetector"></a>GestureDetector</h2><p>用来处理双击、长按、快速滑动等手势<br>GestureDetector 使用时控件要setClickable(true)不然会不准确，具体原因不知道<br><img src="http://ww3.sinaimg.cn/large/87c01ec7gy1fox62kfvf0j20hr0i0dk3.jpg" alt=""></p><h3 id="OnGestureListener"><a href="#OnGestureListener" class="headerlink" title="OnGestureListener"></a>OnGestureListener</h3><p>比较快的点击松开会触发<br>onDown&gt;&gt;onSingleTapUp</p><p>普通速度稍微停留一点的点击松开会触发onDown&gt;&gt;onShowPress&gt;&gt;onSingleTapUp</p><p>长按会触发<br>onDown&gt;&gt;onShowPress&gt;&gt;onLongPress</p><p>普通滚动<br>onDown&gt;&gt;onShowPress&gt;&gt;onScroll(多个)</p><p>快速滚动<br>onDown&gt;&gt;onShowPress&gt;&gt;onScroll(多个)&gt;&gt;onFling</p><h3 id="OnDoubleTapListener"><a href="#OnDoubleTapListener" class="headerlink" title="OnDoubleTapListener"></a>OnDoubleTapListener</h3><p>点击<br>onSingleTapConfirmed</p><p>双击<br>发生一次双击<br>onDoubleTap&gt;&gt;onDoubleTapEvent(两个 这里代表点击次数)</p><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">TextView tvT = (TextView) findViewById(R.id.tv_t);</div><div class="line">tvT.setClickable(<span class="keyword">true</span>);</div><div class="line"><span class="keyword">final</span> GestureDetector gestureDetector =<span class="keyword">new</span> GestureDetector(<span class="keyword">this</span>, <span class="keyword">new</span> GestureDetector.OnGestureListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDown</span><span class="params">(MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">       <span class="comment">// Log.e("手势检测", "轻触屏幕");</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onShowPress</span><span class="params">(MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">       <span class="comment">// Log.e("手势检测", "轻触屏幕未松开");</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onSingleTapUp</span><span class="params">(MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">      <span class="comment">//  Log.e("手势检测", "普通单击");</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onScroll</span><span class="params">(MotionEvent motionEvent, MotionEvent motionEvent1, <span class="keyword">float</span> v, <span class="keyword">float</span> v1)</span> </span>&#123;</div><div class="line">        <span class="comment">//Log.e("手势检测", "普通滑动");</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLongPress</span><span class="params">(MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">        <span class="comment">//Log.e("手势检测", "长按");</span></div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onFling</span><span class="params">(MotionEvent motionEvent, MotionEvent motionEvent1, <span class="keyword">float</span> v, <span class="keyword">float</span> v1)</span> </span>&#123;</div><div class="line">        <span class="comment">//Log.e("手势检测", "快速滑动后松开");</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">gestureDetector.setOnDoubleTapListener(<span class="keyword">new</span> GestureDetector.OnDoubleTapListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onSingleTapConfirmed</span><span class="params">(MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"手势检测"</span>, <span class="string">"严格的单击"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDoubleTap</span><span class="params">(MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"手势检测"</span>, <span class="string">"双击"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDoubleTapEvent</span><span class="params">(MotionEvent motionEvent)</span> </span>&#123;</div><div class="line">        Log.e(<span class="string">"手势检测"</span>, <span class="string">"发生双击行为"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">tvT.setOnTouchListener(<span class="keyword">new</span> View.OnTouchListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View view, MotionEvent event)</span> </span>&#123;</div><div class="line">     <span class="keyword">return</span>  gestureDetector.onTouchEvent(event);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><h2 id="Scroller"><a href="#Scroller" class="headerlink" title="Scroller"></a>Scroller</h2><pre><code>注意View中直接调用scrollBy滑动的是View的Content内容，对于Button，它的Content就是文本，ImageView就是drawable，也就是只能改变view内容的位置而不能改变view在布局的位置。
</code></pre><p>scrollTo(x,y)绝对滑动</p><p>scrollBy(x,y)根据当前位置叠加移动 可多次叠加</p><h2 id="postDelayed-view的定时器"><a href="#postDelayed-view的定时器" class="headerlink" title="postDelayed view的定时器"></a>postDelayed view的定时器</h2><p>例子<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">TextView tvT = (TextView) findViewById(R.id.tv_t);</div><div class="line"> tvT.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">                tvT.setText(<span class="string">"变化前"</span>);</div><div class="line">                tvT.postDelayed(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">                    <span class="meta">@Override</span></div><div class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                        tvT.setText(<span class="string">"变化后"</span>);<span class="comment">//三秒后执行</span></div><div class="line">                    &#125;</div><div class="line">                &#125;,<span class="number">3</span>*<span class="number">1000</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div></pre></td></tr></table></figure><p></p><h2 id="解决滑动冲突的思路"><a href="#解决滑动冲突的思路" class="headerlink" title="解决滑动冲突的思路"></a>解决滑动冲突的思路</h2><p>一般来说就是父容器和子容器or子view的冲突</p><h3 id="外部拦截（父容器负责拦截）"><a href="#外部拦截（父容器负责拦截）" class="headerlink" title="外部拦截（父容器负责拦截）"></a>外部拦截（父容器负责拦截）</h3><p>自定义控件继承父容器重写onInterceptTouchEvent()<br>根据需求决定是否拦截<br>假如子容器or子view 和父容器都需要响应事件的情况下（例如一个要响应向左右一个要响应上下）<br>那么父容器的 MotionEvent.ACTION_DOWN必须返回false 不然事件无法再传给子容器or子view</p><h3 id="内部拦截（子容器-子view负责拦截）"><a href="#内部拦截（子容器-子view负责拦截）" class="headerlink" title="内部拦截（子容器 子view负责拦截）"></a>内部拦截（子容器 子view负责拦截）</h3><p>阻止父层的View截获点击事件<br>自定义控件继承 子容器 子view重写dispatchTouchEvent()<br>根据需求决定是否拦截<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</div><div class="line">		</div><div class="line">		....</div><div class="line">		getParent().requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);<span class="comment">//表示拦截</span></div><div class="line">		.....</div><div class="line">		</div><div class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(event);</div><div class="line">        &#125;</div></pre></td></tr></table></figure><p></p><p>假如子容器or子view 和父容器都需要响应事件的情况下（例如一个要响应向左右一个要响应上下）<br>那么父容器的onInterceptTouchEvent()的 MotionEvent.ACTION_DOWN也必须返回false 不然事件无法再传给子容器or子view</p><h1 id="view的工作原理"><a href="#view的工作原理" class="headerlink" title="view的工作原理"></a>view的工作原理</h1><h1 id="自定义view流程"><a href="#自定义view流程" class="headerlink" title="自定义view流程"></a>自定义view流程</h1><p>getMeasuredWidth()获取的是view原始的大小，也就是这个view在XML文件中配置或者是代码中设置的大小。getWidth（）获取的是这个view最终显示的大小，这个大小有可能等于原始的大小也有可能不等于原始大小。</p><p>自定义view分为两种其中每一种有两个类型。<br>1.完全自定义的<br>继承 View<br>继承 ViewGroup<br>2.继承于特定的控件或者布局的<br>继承某个控件<br>继承某个布局</p><h3 id="自定义属性"><a href="#自定义属性" class="headerlink" title="自定义属性"></a>自定义属性</h3><p>在res 的values 新建attrs 或者attrs_xxxxxx 都可以<br>例子<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">declare-styleable</span> <span class="attr">name</span>=<span class="string">"CircleView"</span>&gt;</span><span class="comment">&lt;!--自定义属性集合CircleView--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">attr</span> <span class="attr">name</span>=<span class="string">"circle_color"</span> <span class="attr">format</span>=<span class="string">"color"</span> /&gt;</span></div><div class="line">         <span class="comment">&lt;!--</span></div><div class="line">          属性定义时可以指定多种类型值</div><div class="line">          format= 类型有</div><div class="line">          reference：参考某一资源ID</div><div class="line">          color：颜色值</div><div class="line">          boolean：布尔值</div><div class="line">          dimension：尺寸值</div><div class="line">          float：浮点值</div><div class="line">          integer：整型值</div><div class="line">          string：字符串</div><div class="line">          fraction：百分数</div><div class="line">         --&gt;</div><div class="line">         <span class="comment">&lt;!--</span></div><div class="line">          enum：枚举值</div><div class="line">           &lt;attr name="orientation"&gt;</div><div class="line">                &lt;enum name="horizontal" value="0" /&gt;</div><div class="line">                &lt;enum name="vertical" value="1" /&gt;</div><div class="line">          &lt;/attr&gt;--&gt;</div><div class="line">         <span class="comment">&lt;!--</span></div><div class="line">         flag：位或运算</div><div class="line">        &lt;attr name="windowSoftInputMode"&gt;</div><div class="line">        &lt;flag name="stateUnspecified" value="0" /&gt;</div><div class="line">        &lt;flag name="stateUnchanged" value="1" /&gt;</div><div class="line">        &lt;flag name="stateHidden" value="2" /&gt;</div><div class="line">        &lt;flag name="stateAlwaysHidden" value="3" /&gt;</div><div class="line">        &lt;flag name="stateVisible" value="4" /&gt;</div><div class="line">        &lt;flag name="stateAlwaysVisible" value="5" /&gt;</div><div class="line">        &lt;flag name="adjustUnspecified" value="0x00" /&gt;</div><div class="line">        &lt;flag name="adjustResize" value="0x10" /&gt;</div><div class="line">        &lt;flag name="adjustPan" value="0x20" /&gt;</div><div class="line">        &lt;flag name="adjustNothing" value="0x30" /&gt;</div><div class="line">        &lt;/attr&gt;</div><div class="line">        使用 android:windowSoftInputMode="stateUnspecified | stateUnchanged　"</div><div class="line">         --&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">declare-styleable</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure><p></p><p>使用<br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">work.model.com.cczhrdraw.CircleView</span></span></div><div class="line">    <span class="attr">android:paddingRight</span>=<span class="string">"40dp"</span></div><div class="line">    <span class="attr">app:circle_color</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@color/colorAccent"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</div></pre></td></tr></table></figure><p></p><p>拿数据<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.CircleView);</div><div class="line">   mColor = a.getColor(R.styleable.CircleView_circle_color, Color.RED);</div></pre></td></tr></table></figure><p></p><h3 id="自定义view"><a href="#自定义view" class="headerlink" title="自定义view"></a>自定义view</h3><p>例子<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleView</span> <span class="keyword">extends</span> <span class="title">View</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mColor = Color.RED;</div><div class="line">    <span class="keyword">private</span> Paint mPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.CircleView);</div><div class="line">        mColor = a.getColor(R.styleable.CircleView_circle_color, Color.RED);</div><div class="line">        a.recycle();<span class="comment">//回收TypedArray</span></div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        mPaint.setColor(mColor);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        <span class="keyword">int</span> widthSpecMode = MeasureSpec.getMode(widthMeasureSpec);<span class="comment">//得到宽度的测量模式</span></div><div class="line">        <span class="keyword">int</span> widthSpecSize = MeasureSpec.getSize(widthMeasureSpec);<span class="comment">//得到宽度的数值</span></div><div class="line">        <span class="keyword">int</span> heightSpecMode = MeasureSpec.getMode(heightMeasureSpec);<span class="comment">//得到长度的测量模式</span></div><div class="line">        <span class="keyword">int</span> heightSpecSize = MeasureSpec.getSize(heightMeasureSpec);<span class="comment">//得到长度的数值</span></div><div class="line"></div><div class="line">        <span class="comment">/*</span></div><div class="line">        测量模式：</div><div class="line">        UNSPECIFIED：不限制 match_parent</div><div class="line">        AT_MOST：限制上限 wrap_content</div><div class="line">        EXACTLY：限制固定值 手动自定义</div><div class="line">*/</div><div class="line">        <span class="keyword">if</span> (widthSpecMode == MeasureSpec.AT_MOST</div><div class="line">                &amp;&amp; heightSpecMode == MeasureSpec.AT_MOST) &#123;</div><div class="line">            setMeasuredDimension(<span class="number">200</span>, <span class="number">200</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (widthSpecMode == MeasureSpec.AT_MOST) &#123;</div><div class="line">            setMeasuredDimension(<span class="number">200</span>, heightSpecSize);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (heightSpecMode == MeasureSpec.AT_MOST) &#123;</div><div class="line">            setMeasuredDimension(widthSpecSize, <span class="number">200</span>);<span class="comment">//这里设的大小相当于Canvas大小</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDraw(canvas);</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> paddingLeft = getPaddingLeft();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> paddingRight = getPaddingRight();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> paddingTop = getPaddingTop();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> paddingBottom = getPaddingBottom();</div><div class="line">        <span class="keyword">int</span> width = getWidth() - paddingLeft - paddingRight;</div><div class="line">        <span class="keyword">int</span> height = getHeight() - paddingTop - paddingBottom;</div><div class="line">        <span class="keyword">int</span> radius = Math.min(width, height) / <span class="number">2</span>;</div><div class="line"></div><div class="line">        canvas.drawCircle(paddingLeft+ width / <span class="number">2</span>, paddingTop+ height / <span class="number">2</span>,radius, mPaint);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p></p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Android/" rel="tag"># Android</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/02/15/java细节笔记/" rel="next" title="java细节笔记"><i class="fa fa-chevron-left"></i> java细节笔记</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2018/03/09/Android的悬浮窗/" rel="prev" title="Android的悬浮窗">Android的悬浮窗<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div id="sidebar-dimmer"></div><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://tva2.sinaimg.cn/crop.0.103.494.494.180/95a356e5jw8erb6uslwmrj20dq0jgjry.jpg" alt="cczhr"><p class="site-author-name" itemprop="name">cczhr</p><p class="site-description motion-element" itemprop="description">或许你真的可以改变世界。</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">65</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">25</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/cczhr" title="GitHub &rarr; https://github.com/cczhr" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:cczhr.dev@gmail.com" title="E-Mail &rarr; mailto:cczhr.dev@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://weibo.com/cczhr" title="Weibo &rarr; https://weibo.com/cczhr" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span></div></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#注意"><span class="nav-number">1.</span> <span class="nav-text">注意</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#绘图"><span class="nav-number">2.</span> <span class="nav-text">绘图</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Paint-画笔"><span class="nav-number">2.1.</span> <span class="nav-text">Paint 画笔</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Canvas-画布"><span class="nav-number">2.2.</span> <span class="nav-text">Canvas 画布</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#描述路径Path"><span class="nav-number">2.2.1.</span> <span class="nav-text">描述路径Path</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#图形交叉的填充方式"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">图形交叉的填充方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#路径方向-Direction-dir"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">路径方向(Direction dir)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加图形"><span class="nav-number">2.2.1.3.</span> <span class="nav-text">添加图形</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加线条"><span class="nav-number">2.2.1.4.</span> <span class="nav-text">添加线条</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#移动坐标"><span class="nav-number">2.2.1.5.</span> <span class="nav-text">移动坐标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#画弧形"><span class="nav-number">2.2.1.6.</span> <span class="nav-text">画弧形</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#平移"><span class="nav-number">2.2.1.7.</span> <span class="nav-text">平移</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加另一个path"><span class="nav-number">2.2.1.8.</span> <span class="nav-text">添加另一个path</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PathMeasure-测量path"><span class="nav-number">2.2.1.9.</span> <span class="nav-text">PathMeasure 测量path</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#绘制顺序"><span class="nav-number">2.3.</span> <span class="nav-text">绘制顺序</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#动画"><span class="nav-number">3.</span> <span class="nav-text">动画</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#属性动画"><span class="nav-number">3.1.</span> <span class="nav-text">属性动画</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ViewPropertyAnimator"><span class="nav-number">3.1.1.</span> <span class="nav-text">ViewPropertyAnimator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ObjectAnimator"><span class="nav-number">3.1.2.</span> <span class="nav-text">ObjectAnimator</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#事件分发机制"><span class="nav-number">4.</span> <span class="nav-text">事件分发机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#view的事件分发机制"><span class="nav-number">4.1.</span> <span class="nav-text">view的事件分发机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#dispatchTouchEvent-事件分发-Activity-ViewGroup-View"><span class="nav-number">4.1.1.</span> <span class="nav-text">dispatchTouchEvent 事件分发(Activity ViewGroup View)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#onInterceptTouchEvent-事件拦截-ViewGroup-ViewGroup默认不拦截"><span class="nav-number">4.1.2.</span> <span class="nav-text">onInterceptTouchEvent 事件拦截(ViewGroup) ViewGroup默认不拦截</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#onTouchEvent-事件消费-Activity-ViewGroup-View-主要处理点击事件"><span class="nav-number">4.1.3.</span> <span class="nav-text">onTouchEvent 事件消费(Activity ViewGroup View) 主要处理点击事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#view的分发"><span class="nav-number">4.1.4.</span> <span class="nav-text">view的分发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VIewGroup的分发"><span class="nav-number">4.1.5.</span> <span class="nav-text">VIewGroup的分发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MotionEvent"><span class="nav-number">4.2.</span> <span class="nav-text">MotionEvent</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TouchSlop"><span class="nav-number">4.3.</span> <span class="nav-text">TouchSlop</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VelocityTracker"><span class="nav-number">4.4.</span> <span class="nav-text">VelocityTracker</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GestureDetector"><span class="nav-number">4.5.</span> <span class="nav-text">GestureDetector</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OnGestureListener"><span class="nav-number">4.5.1.</span> <span class="nav-text">OnGestureListener</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OnDoubleTapListener"><span class="nav-number">4.5.2.</span> <span class="nav-text">OnDoubleTapListener</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#例子"><span class="nav-number">4.5.3.</span> <span class="nav-text">例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scroller"><span class="nav-number">4.6.</span> <span class="nav-text">Scroller</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#postDelayed-view的定时器"><span class="nav-number">4.7.</span> <span class="nav-text">postDelayed view的定时器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解决滑动冲突的思路"><span class="nav-number">4.8.</span> <span class="nav-text">解决滑动冲突的思路</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#外部拦截（父容器负责拦截）"><span class="nav-number">4.8.1.</span> <span class="nav-text">外部拦截（父容器负责拦截）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内部拦截（子容器-子view负责拦截）"><span class="nav-number">4.8.2.</span> <span class="nav-text">内部拦截（子容器 子view负责拦截）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#view的工作原理"><span class="nav-number">5.</span> <span class="nav-text">view的工作原理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#自定义view流程"><span class="nav-number">6.</span> <span class="nav-text">自定义view流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义属性"><span class="nav-number">6.0.1.</span> <span class="nav-text">自定义属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义view"><span class="nav-number">6.0.2.</span> <span class="nav-text">自定义view</span></a></li></ol></li></ol></div></div></div><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">cczhr</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span title="站点总字数">312k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">4:44</span></div><div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.2.2</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.0.0</div></div></footer></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/src/utils.js?v=7.0.0"></script><script src="/js/src/motion.js?v=7.0.0"></script><script src="/js/src/affix.js?v=7.0.0"></script><script src="/js/src/schemes/pisces.js?v=7.0.0"></script><script src="/js/src/scrollspy.js?v=7.0.0"></script><script src="/js/src/post-details.js?v=7.0.0"></script><script src="/js/src/bootstrap.js?v=7.0.0"></script><script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js"></script><script>var GUEST=["nick","mail","link"],guest="nick";guest=guest.split(",").filter(function(e){return-1<GUEST.indexOf(e)}),new Valine({el:"#comments",verify:!1,notify:!1,appId:"aMSu6hzeOMWDmzPvSSupyCSz-gzGzoHsz",appKey:"kXxUv0I5NdmApftPNoX8nBul",placeholder:"leave a message",avatar:"wavatar",meta:guest,pageSize:"10",visitor:!1})</script><script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/hijiki.model.json"},display:{position:"left",width:112.5,height:225,vOffset:-110},mobile:{show:!1},log:!1})</script><script async>window.onload=function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.src="/sw-register.js?v="+Date.now(),t.parentNode.insertBefore(e,t)}</script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>